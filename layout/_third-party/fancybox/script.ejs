<script>
  function pjax_fancybox() {
    const group = new Set();

    $(".md .gallery").each(function (index, ele) {
      if ($(ele).has('img').length) {
        group.add($(ele).attr('data-group') || 'default');
      }
    })

    for (const iterator of group) {
      $('[data-fancybox="' + iterator + '"]').fancybox({
        hash: false,
        loop: true,
        closeClick: true,
        helpers: {
          overlay: {closeClick: true}
        },
        buttons: [
          "zoom",
          "slideShow",
          "fullScreen",
          "download",
          "thumbs",
          "close"
        ]
      });
    }
  };

  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    volantis.css("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css");
    volantis.js('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
  };

  $(function () {
    SCload_fancybox();
  });

  function Pjax_SCload_fancybox(){
	  if (typeof $.fancybox == "undefined") {
	    SCload_fancybox();
    } else {
	    pjax_fancybox();
    }
  }

  volantis.pjax.push(Pjax_SCload_fancybox)
  volantis.pjax.send(()=>{
    if (typeof $.fancybox != "undefined") {
      $.fancybox.close();    // 关闭弹窗
    }
  },'fancybox')
</script>
