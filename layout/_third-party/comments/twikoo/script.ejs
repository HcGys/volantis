<script>
  function load_twikoo() {
    if(!document.querySelectorAll("#twikoo_container")[0])return;
    volantis.js("<%- theme.comments.twikoo.js || 'https://cdn.jsdelivr.net/npm/twikoo@latest' %>", pjax_twikoo)
  }
  function pjax_twikoo() {
    if(!document.querySelectorAll("#twikoo_container")[0])return;
    let path = pdata.commentPath;
    let placeholder = pdata.commentPlaceholder || "<%= theme.comments.twikoo.placeholder %>" || "";
    if (path.length == 0) {
      let defaultPath = '<%= theme.comments.twikoo.path %>';
      path = defaultPath || "decodeURI(window.location.pathname)"; //神奇的pathname
    }
    twikoo.init(Object.assign(<%- JSON.stringify(theme.comments.twikoo) %>, {
      el: '#twikoo_container',
      path: path,
      placeholder: placeholder
    })).then(function () {
      volantis.selectComment = volantis.selectComment === undefined ? 'beaudar' : volantis.selectComment;
      if(volantis.selectComment === 'beaudar') {
        document.getElementById('twikoo').style.display = 'none';
        document.getElementById('beaudar_container').style.display = 'block';
      } else {
        document.getElementById('twikoo').style.display = 'block';
        document.getElementById('beaudar_container').style.display = 'none';
      }
    });
  }
  load_twikoo();
  volantis.pjax.push(()=>{
    if (typeof twikoo == "undefined") {
      load_twikoo();
    } else {
      pjax_twikoo();
    }
  },'twikoo');
</script>


<script>
  volantis.beaudar = {};
  function pjax_beaudar() {
    volantis.selectComment = volantis.selectComment === undefined ? 'beaudar' : volantis.selectComment;
    let beaudar_container = document.getElementById("beaudar_container");
    if(!beaudar_container) return;

    setTimeout(() => {
      let checkBeaudar = setInterval(() => {
        let HEAD = document.getElementById("beaudar_container");
        if (!HEAD) return;
        clearInterval(checkBeaudar)
        try {
          document.getElementById("beaudar_container").innerHTML="";
        } catch (error) {}
        if(volantis.dark.mode === "dark"){
          volantis.beaudar.Theme='github-dark';
        }else{
          volantis.beaudar.Theme='github-light';
        }
        const script = document.createElement('script');
        script.setAttribute('src', 'https://beaudar.lipk.org/client.js');
        script.setAttribute('repo', 'inkss/blog-comments');
        script.setAttribute('issue-term', 'pathname');
        script.setAttribute('input-position', 'top');
        script.setAttribute('crossorigin', 'anonymous');
        script.setAttribute('theme', volantis.beaudar.Theme);
        HEAD.appendChild(script);
      })
    }, 200)
  }
  pjax_beaudar();
  volantis.pjax.push(pjax_beaudar);
  volantis.dark.push(pjax_beaudar);
</script>
